--- ../010-simple-class/exp/__zz_cib_internal/example-postdef.h
+++ exp/__zz_cib_internal/example-postdef.h
@@ -7,18 +7,106 @@
 #include "__zz_cib_internal/__zz_cib_Example-mtable-helper.h"
 
 namespace __zz_cib_ {
-using namespace ::Example;
 template <typename T>
-struct __zz_cib_Helper<::Example::A, T> : public __zz_cib_MethodTableHelper {
-  static_assert(std::is_same_v<T, ::Example::A>);
+struct __zz_cib_Helper<::A, T> : public __zz_cib_MethodTableHelper {
+  static_assert(std::is_same_v<T, ::A>);
   using __zz_cib_AbiType = typename T::__zz_cib_AbiType;
   using _ProxyClass = T;
-  friend class ::Example::A;
-  using __zz_cib_Methodid = __zz_cib_::__zz_cib_ids::__zz_cib_Class258::__zz_cib_Class259::__zz_cib_Methodid;
+  friend class ::A;
+  Example::__zz_cib_HandleProxyMap<_ProxyClass> proxyMgr;
+  using __zz_cib_Methodid = __zz_cib_::__zz_cib_ids::__zz_cib_Class258::__zz_cib_Methodid;
 
   __zz_cib_Helper()
     : __zz_cib_MethodTableHelper(
-      __zz_cib_ExampleGetMethodTable(__zz_cib_ids::__zz_cib_Class258::__zz_cib_Class259::__zz_cib_classId))
+      __zz_cib_ExampleGetMethodTable(__zz_cib_ids::__zz_cib_Class258::__zz_cib_classId))
+  {}
+  static __zz_cib_Helper& __zz_cib_Instance() {
+    static __zz_cib_Helper helper;
+    return helper;
+  }
+  static __zz_cib_MethodTableHelper& __zz_cib_GetMethodTable() {
+    return __zz_cib_Instance();
+  }
+
+  template <typename ..._Args>
+  static __zz_cib_AbiType __zz_cib_Copy_0(_Args... __zz_cib_args) {
+    using __zz_cib_ProcType = __zz_cib_AbiType (__zz_cib_decl *) (_Args...);
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::__zz_cib_Copy_0>(
+      __zz_cib_args...);
+  }
+  static __zz_cib_AbiType __zz_cib_New_1() {
+    using __zz_cib_ProcType = __zz_cib_AbiType (__zz_cib_decl *) ();
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::__zz_cib_New_1>(
+      );
+  }
+  template <typename _RT>
+  static auto VirtFunc_2(__zz_cib_AbiType __zz_cib_obj) {
+    using __zz_cib_ProcType = _RT (__zz_cib_decl *) (__zz_cib_AbiType);
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::VirtFunc_2>(
+      __zz_cib_obj
+      );
+  }
+  static auto __zz_cib_Delete_3(__zz_cib_AbiType __zz_cib_obj) {
+    if (__zz_cib_obj) {
+      using __zz_cib_ProcType = void (__zz_cib_decl *) (__zz_cib_AbiType);
+      return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::__zz_cib_Delete_3>(
+        __zz_cib_obj
+        );
+    }
+  }
+  static T* __zz_cib_CreateProxy(__zz_cib_AbiType h) {
+auto* const __zz_cib_obj = new T(h);
+    return __zz_cib_obj;
+  }
+  static T __zz_cib_ObjectFromHandle(__zz_cib_AbiType h) {
+    return T(h);
+  }
+  static __zz_cib_AbiType& __zz_cib_GetHandle(T* __zz_cib_obj) {
+    return __zz_cib_obj->__zz_cib_h_;
+  }
+  static __zz_cib_AbiType const& __zz_cib_GetHandle(const T* __zz_cib_obj) {
+    return __zz_cib_obj->__zz_cib_h_;
+  }
+  static __zz_cib_AbiType __zz_cib_ReleaseHandle(T* __zz_cib_obj) {
+    if (__zz_cib_obj->__zz_cib_h_ == nullptr) return nullptr;
+    __zz_cib_RemoveProxy(__zz_cib_obj->__zz_cib_h_);
+    auto h = __zz_cib_obj->__zz_cib_h_;
+    __zz_cib_obj->__zz_cib_h_ = nullptr;
+    return h;
+  }
+  static _ProxyClass* __zz_cib_FromHandle(__zz_cib_AbiType h) {
+    if (h == nullptr)
+      return nullptr;
+    auto&  dis   = __zz_cib_Instance();
+    auto* proxy = dis.proxyMgr.FindProxy(h);
+    if (proxy == nullptr)
+      proxy = __zz_cib_CreateProxy(h);
+    return proxy;
+  }
+  static void __zz_cib_AddProxy(_ProxyClass* __zz_cib_obj, __zz_cib_AbiType h) {
+    auto& dis = __zz_cib_Instance();
+    dis.proxyMgr.AddProxy(__zz_cib_obj, h);
+  }
+  static void __zz_cib_RemoveProxy(__zz_cib_AbiType h) {
+    auto& dis = __zz_cib_Instance();
+      dis.proxyMgr.RemoveProxy(h);
+  }
+};
+}
+
+namespace __zz_cib_ {
+template <typename T>
+struct __zz_cib_Helper<::B, T> : public __zz_cib_MethodTableHelper {
+  static_assert(std::is_same_v<T, ::B>);
+  using __zz_cib_AbiType = typename T::__zz_cib_AbiType;
+  using _ProxyClass = T;
+  friend class ::B;
+  Example::__zz_cib_HandleProxyMap<_ProxyClass> proxyMgr;
+  using __zz_cib_Methodid = __zz_cib_::__zz_cib_ids::__zz_cib_Class259::__zz_cib_Methodid;
+
+  __zz_cib_Helper()
+    : __zz_cib_MethodTableHelper(
+      __zz_cib_ExampleGetMethodTable(__zz_cib_ids::__zz_cib_Class259::__zz_cib_classId))
   {}
   static __zz_cib_Helper& __zz_cib_Instance() {
     static __zz_cib_Helper helper;
@@ -48,12 +136,26 @@
       );
   }
   template <typename _RT>
-  static auto SomeFunc_3(__zz_cib_AbiType __zz_cib_obj) {
+  static auto VirtFunc_3(__zz_cib_AbiType __zz_cib_obj) {
     using __zz_cib_ProcType = _RT (__zz_cib_decl *) (__zz_cib_AbiType);
-    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::SomeFunc_3>(
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::VirtFunc_3>(
       __zz_cib_obj
       );
   }
+  template <typename _RT>
+  static auto Create_4() {
+    using __zz_cib_ProcType = _RT (__zz_cib_decl *) ();
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::Create_4>(
+      );
+  }
+  static A::__zz_cib_AbiType __zz_cib_CastTo__zz_cib_Class258(__zz_cib_AbiType __zz_cib_obj) {
+    using __zz_cib_ProcType = A::__zz_cib_AbiType (__zz_cib_decl *) (__zz_cib_AbiType);
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::__zz_cib_CastTo__zz_cib_Class258>(__zz_cib_obj);
+  }
+  static __zz_cib_AbiType __zz_cib_CastFrom__zz_cib_Class258(A::__zz_cib_AbiType  __zz_cib_obj) {
+    using __zz_cib_ProcType = __zz_cib_AbiType (__zz_cib_decl *) (A::__zz_cib_AbiType);
+    return __zz_cib_GetMethodTable().Invoke<__zz_cib_ProcType, __zz_cib_Methodid::__zz_cib_CastFrom__zz_cib_Class258>(__zz_cib_obj);
+  }
   static T* __zz_cib_CreateProxy(__zz_cib_AbiType h) {
 auto* const __zz_cib_obj = new T(h);
     return __zz_cib_obj;
@@ -69,12 +171,28 @@
   }
   static __zz_cib_AbiType __zz_cib_ReleaseHandle(T* __zz_cib_obj) {
     if (__zz_cib_obj->__zz_cib_h_ == nullptr) return nullptr;
+    __zz_cib_RemoveProxy(__zz_cib_obj->__zz_cib_h_);
     auto h = __zz_cib_obj->__zz_cib_h_;
     __zz_cib_obj->__zz_cib_h_ = nullptr;
+    __zz_cib_::__zz_cib_Helper<::A>::__zz_cib_ReleaseHandle(__zz_cib_obj);
     return h;
   }
   static _ProxyClass* __zz_cib_FromHandle(__zz_cib_AbiType h) {
-    return __zz_cib_CreateProxy(h);
+    if (h == nullptr)
+      return nullptr;
+    auto&  dis   = __zz_cib_Instance();
+    auto* proxy = dis.proxyMgr.FindProxy(h);
+    if (proxy == nullptr)
+      proxy = __zz_cib_CreateProxy(h);
+    return proxy;
+  }
+  static void __zz_cib_AddProxy(_ProxyClass* __zz_cib_obj, __zz_cib_AbiType h) {
+    auto& dis = __zz_cib_Instance();
+    dis.proxyMgr.AddProxy(__zz_cib_obj, h);
+  }
+  static void __zz_cib_RemoveProxy(__zz_cib_AbiType h) {
+    auto& dis = __zz_cib_Instance();
+      dis.proxyMgr.RemoveProxy(h);
   }
 };
 }
